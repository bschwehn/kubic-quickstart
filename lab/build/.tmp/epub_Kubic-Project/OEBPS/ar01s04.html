<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Section 4: Bootstrap the Cluster</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2"/></head><body><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="_section_4_bootstrap_the_cluster"/>Section 4: Bootstrap the Cluster</h1></div></div></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="col_1"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
              <p class="lead">Description:</p>
              <p>In this section you will bootstrap your Kubic Kubernetes cluster</p>
            </td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_task_1_set_up_kubic_master"/>Task 1: Set up Kubic-Master</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Login into the <span class="strong"><strong>Kubic-Master</strong></span> VM if you have not already done so:</p><p><span class="strong"><strong><span class="gray">Userid</span></strong></span>: <span class="strong"><strong>root</strong></span></p><p><span class="strong"><strong><span class="gray">Password</span></strong></span>: <span class="strong"><strong>[your root password]</strong></span></p></li><li class="listitem"><p>Run the following command to configure this as a Kubernetes master
node:</p><p><code class="literal"><span class="strong"><strong><span class="blue">kubeadm init --cri-socket=/var/run/crio/crio.sock \</span></strong></span></code>
 <code class="literal"><span class="strong"><strong><span class="blue">--pod-network-cidr=10.244.0.0/16</span></strong></span></code></p><p>You should see some output and at the end, you will see this:</p><p>You can now join any number of machines by running the following on each
node as root:</p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">kubeadm join 10.0.2.11:6443 --token …</span>
              </strong></span>
            </code>
          </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>Save this command. You will need it later!</p></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_task_2_optional_add_a_second_network_interface_to_kubic_master_vm"/>Task 2: (optional) Add a second network interface to Kubic-Master VM</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Power off the Kubic-Master VM</p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">halt -p</span>
              </strong></span>
            </code>
          </p></li><li class="listitem"><p>From the main Virtualbox screen, choose the <span class="strong"><strong>Kubic-Master VM</strong></span> and
click on Settings</p></li><li class="listitem"><p>Click on the Network icon</p></li><li class="listitem"><p>Click on the Adaptor 2 tab</p><p>Change Attached to to Bridged Adaptor</p><p>Name should automatically change to whatever physical network adaptor
you are using.</p></li><li class="listitem"><p>From the main Virtualbox screen, choose the <span class="strong"><strong>Kubic-Master</strong></span> VM and
click on the down arrow next to the start icon. Click on Detachable
Start</p></li><li class="listitem"><p>Log into the command line:</p><p>Userid: <span class="strong"><strong>root</strong></span></p><p>Password: <span class="strong"><strong>[your root password]</strong></span></p></li><li class="listitem"><p>Start the curses version of yast to configure networking on the new
nic</p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">yast2 lan</span>
              </strong></span>
            </code>
          </p></li><li class="listitem"><p>Use the <span class="strong"><strong>F4</strong></span> key on your keyboard to edit the new nic</p></li><li class="listitem"><p>Click on <span class="strong"><strong>alt y</strong></span> on your keyboard to change this nic to DHCP. If
your network does not have DHCP, set a static IP instead.</p></li><li class="listitem"><p>Click on <span class="strong"><strong>F10</strong></span> on your keyboard to exit this screen</p></li><li class="listitem"><p>Click on <span class="strong"><strong>F10</strong></span> on your keyboard to exit yast</p></li><li class="listitem"><p>Find your new IP addresses</p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">ip a</span>
              </strong></span>
            </code>
          </p><p>You should now be able to log into the Kubic-Master using the terminal
or application of your choice. You can also now copy and paste from this
book.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_task_3_set_up_the_kubic_workers"/>Task 3: Set up the Kubic-Workers</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Login to the Kubic-Worker1 VM if you have not already done so:</p><p>Userid: <span class="strong"><strong>root</strong></span></p><p>Password: <span class="strong"><strong>[your root password]</strong></span></p></li><li class="listitem"><p>Run the output command from Task 1 and add</p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">--cri-socket=/var/run/crio/crio.sock</span>
              </strong></span>
            </code>
          </p><p>to the end of the command</p></li><li class="listitem"><p>Repeat this task for every worker VM</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_task_4_set_up_the_kubectl"/>Task 4: Set up the kubectl</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>On the <span class="strong"><strong>Kubic-Master</strong></span> VM, copy and set up the config file so that
kubectl can interact with the cluster:</p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">mkdir -p $HOME/.kube</span>
              </strong></span>
            </code>
          </p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span>
              </strong></span>
            </code>
          </p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span>
              </strong></span>
            </code>
          </p></li><li class="listitem"><p>Check on your nodes</p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">kubectl get nodes</span>
              </strong></span>
            </code>
          </p><p>You should have 3 nodes. All of them should be in a NotReady status</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_task_5_set_up_flannel"/>Task 5: Set up Flannel</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Run the following command to install flannel on your cluster:</p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">kubectl apply -f <a class="link" href="https://0y.at/kubicflannel">https://0y.at/kubicflannel</a></span>
              </strong></span>
            </code>
          </p></li><li class="listitem"><p>Check on your nodes</p><p>
            <code class="literal">
              <span class="strong"><strong>
                <span class="blue">watch kubectl get nodes</span>
              </strong></span>
            </code>
          </p><p>In 1-2 minutes all of them should be in a Ready status. Click on <span class="strong"><strong>Ctrl
c</strong></span> on your keyboard to exit this screen.</p><p>You now have a fully functional Kubernetes cluster! You can add more
worker nodes at any time and then bootstrap them in like you did above.</p></li></ol></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="col_1"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
                <p>Summary:</p>
                <p>In this section you completed your Kubic Kubernetes cluster. It is now
fully functional and ready to be used.</p>
              </td></tr></tbody></table></div><p>
        
      </p></div></div></body></html>